#!/usr/bin/env bash

TODO_FILE="$HOME/todo.txt"
touch "$TODO_FILE"
USAGE_STRING="Usage: $0 [add <todo> | rm <number> | nuke]"

function show_todos() {
    if [ -s "$TODO_FILE" ]; then
        echo "Your current to-dos:"
        nl -w2 -s'. ' "$TODO_FILE"
    else
        echo "No todos found."
    fi
}

function add_todo() {
    shift
    echo "$*" >> "$TODO_FILE"
    show_todos
}

function remove_todo() {
    local todo_number=$1
    if ! [[ "$todo_number" =~ ^[0-9]+$ ]]; then
        echo "Error: Please provide a valid number."
        exit 1
    fi

    if [ -s "$TODO_FILE" ]; then
        sed -i "${todo_number}d" "$TODO_FILE"
        show_todos
    else
        echo "No todos to remove."
    fi
}

function nuke_todos() {
    if [ -s "$TODO_FILE" ]; then
        read -p "Are you sure you want to clear all tasks? (Y/n): " CONFIRM
        CONFIRM=${CONFIRM:-y}
        if [[ "$CONFIRM" =~ ^[Yy]$ ]]; then
            > "$TODO_FILE"
            echo "All tasks have been cleared."
        else
            echo "Nuke operation cancelled."
        fi
    else
        echo "No todos to clear."
    fi
}

# Main script logic
case "$1" in
    "")
        show_todos
        ;;
    add)
        if [ $# -gt 1 ]; then
            add_todo "$@"
        else
            echo "Error: No todo item specified."
            exit 1
        fi
        ;;
    rm)
        if [ $# -eq 2 ]; then
            remove_todo "$2"
        else
            echo "Error: Please provide a valid number."
            exit 1
        fi
        ;;
    nuke)
        nuke_todos
        ;;
    *)
        echo "$USAGE_STRING"
        ;;
esac

